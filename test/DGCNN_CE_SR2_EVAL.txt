Cannot import torchlars
Cannot load RSCNN: No module named 'pointnet2_ops'
Cannot load PCT: No module named 'pointnet2_ops'
Cannot load PointMLP: No module named 'pointnet2_ops'
Cannot load PointNet2: No module named 'pointnet2_ops'
out-of-distribution eval - Modelnet -> SONN ..
Arguments: Namespace(local_rank=None, use_sync_bn=False, use_amp=False, script_mode='eval', config='cfgs/dgcnn-cla.yaml', seed=1, epochs=250, batch_size=1, num_workers=4, resume=None, apply_fix_cellphone=True, data_root='./3D_OS_release_data', checkpoints_dir='outputs', exp_name='DGCNN_CE_SR2_EVAL', eval_step=1, save_step=10, ckpt_path='outputs/DGCNN_CE_SR2_wEVAL/models/model_last.pth', src='SR2', sonn_split='main_split', sonn_h5_name='objectdataset.h5', augm_set='rw', grad_norm_clip=-1, num_points=1024, num_points_test=2048, wandb_name=None, wandb_group='md-2-sonn-augmCorr', wandb_proj='benchmark-3d-ood-cla', loss='CE', cs=False, cs_gan_lr=0.0002, cs_beta=0.1, save_feats=None, corruption=None, tar1='none', tar2='none')
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR2_train.h5
ModelNet40_OOD - split: train, categories: {'bed': 0, 'toilet': 1, 'desk': 2, 'monitor': 3, 'table': 2}
SR2 train data len: 1916
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR2_test.h5
ModelNet40_OOD - split: test, categories: {'bed': 0, 'toilet': 1, 'desk': 2, 'monitor': 3, 'table': 2}
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Src is SR2

ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {10: 0, 14: 1, 5: 2, 6: 3, 9: 2}, num samples: 788
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {4: 0, 8: 1, 7: 2, 12: 3, 13: 4}, num samples: 1255
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {0: 404, 1: 404, 2: 404, 3: 404, 11: 404}, num samples: 847
dgcnn k: 20
dgcnn emb_dims: 1024
Clf - feature encoder: DGCNN
Clf Head - num classes: 4, input dim: 2048, act: leakyrelu, dropout: 0.5
Model params count: 1.8001 M
Load weights:  <All keys matched successfully>
100% 788/788 [00:16<00:00, 49.04it/s]
100% 1255/1255 [00:24<00:00, 50.57it/s]
100% 847/847 [00:16<00:00, 49.82it/s]

################################################################################
Computing OOD metrics with MSP normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7043147208121827, Clf Bal Acc: 0.6339154478455111
SRC->TAR1:      AUROC: 0.5809, FPR95: 0.8988, AUPR_IN: 0.4265, AUPR_OUT: 0.6909
SRC->TAR2:      AUROC: 0.6409, FPR95: 0.8855, AUPR_IN: 0.6095, AUPR_OUT: 0.6368
SRC->TAR1+TAR2: AUROC: 0.6051, FPR95: 0.8934, AUPR_IN: 0.3343, AUPR_OUT: 0.7977
to spreadsheet: 0.5809128966368031,0.8988047808764941,0.42654952436600746,0.690915257885236,0.6409033974793089,0.885478158205431,0.6094779104309311,0.6367934269548483,0.6050860432655387,0.8934348239771646,0.3343372286772031,0.7976581203190609
################################################################################

################################################################################
Computing OOD metrics with MLS normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7043147208121827, Clf Bal Acc: 0.6339154478455111
SRC->TAR1:      AUROC: 0.6250, FPR95: 0.9004, AUPR_IN: 0.4644, AUPR_OUT: 0.7201
SRC->TAR2:      AUROC: 0.6100, FPR95: 0.8985, AUPR_IN: 0.5818, AUPR_OUT: 0.6145
SRC->TAR1+TAR2: AUROC: 0.6189, FPR95: 0.8996, AUPR_IN: 0.3485, AUPR_OUT: 0.8051
to spreadsheet: 0.6249580358767974,0.900398406374502,0.46437828260263436,0.7200892852813595,0.6099925685758634,0.898465171192444,0.5818188734992322,0.6145120123074708,0.6189277072355552,0.8996194100856327,0.348454288136389,0.8050721872841083
################################################################################

################################################################################
Computing OOD metrics with entropy normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7043147208121827, Clf Bal Acc: 0.6339154478455111
SRC->TAR1:      AUROC: 0.5851, FPR95: 0.8956, AUPR_IN: 0.4278, AUPR_OUT: 0.6952
SRC->TAR2:      AUROC: 0.6420, FPR95: 0.8890, AUPR_IN: 0.6098, AUPR_OUT: 0.6364
SRC->TAR1+TAR2: AUROC: 0.6081, FPR95: 0.8930, AUPR_IN: 0.3350, AUPR_OUT: 0.7996
to spreadsheet: 0.5851264990798228,0.895617529880478,0.42782775924115635,0.6951899793487766,0.6420181110997909,0.8890200708382526,0.6097954889615613,0.6363935804831923,0.6080509497843485,0.8929590865842055,0.33504649269623726,0.799620913212175
################################################################################

################################################################################
Computing OOD metrics with distance from train features...
  0% 0/1916 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1916/1916 [00:12<00:00, 152.81it/s]
100% 788/788 [00:16<00:00, 49.22it/s]
100% 1255/1255 [00:25<00:00, 48.69it/s]
100% 847/847 [00:17<00:00, 48.95it/s]
Euclidean distances in a non-normalized space:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7157360406091371, Clf Bal Acc: 0.6376159650886777
SRC->TAR1:      AUROC: 0.6287, FPR95: 0.9092, AUPR_IN: 0.5457, AUPR_OUT: 0.7029
SRC->TAR2:      AUROC: 0.6631, FPR95: 0.8536, AUPR_IN: 0.6391, AUPR_OUT: 0.6644
SRC->TAR1+TAR2: AUROC: 0.6425, FPR95: 0.8868, AUPR_IN: 0.4259, AUPR_OUT: 0.8110
to spreadsheet: 0.6286690800250774,0.9091633466135458,0.5457398369200877,0.7028923853753736,0.6630935400547767,0.8536009445100354,0.6391491536131821,0.664419750110425,0.6425404014547422,0.8867745004757374,0.42591809155897675,0.8110207642058365

Euclidean distances with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.1713197969543147, Clf Bal Acc: 0.25
SRC->TAR1:      AUROC: 0.5708, FPR95: 0.9466, AUPR_IN: 0.4556, AUPR_OUT: 0.6507
SRC->TAR2:      AUROC: 0.5622, FPR95: 0.9575, AUPR_IN: 0.5645, AUPR_OUT: 0.5383
SRC->TAR1+TAR2: AUROC: 0.5673, FPR95: 0.9510, AUPR_IN: 0.3399, AUPR_OUT: 0.7510
to spreadsheet: 0.570759601189152,0.9466135458167331,0.455559199472742,0.6506856098467069,0.5622052151816803,0.9574970484061394,0.564469003503825,0.538337258256887,0.5673126150101184,0.9509990485252141,0.33991025249637874,0.7510254218816474

Cosine similarities on the hypersphere:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7093908629441624, Clf Bal Acc: 0.6387140174702498
SRC->TAR1:      AUROC: 0.6548, FPR95: 0.8916, AUPR_IN: 0.5637, AUPR_OUT: 0.7263
SRC->TAR2:      AUROC: 0.6679, FPR95: 0.8796, AUPR_IN: 0.6542, AUPR_OUT: 0.6557
SRC->TAR1+TAR2: AUROC: 0.6601, FPR95: 0.8868, AUPR_IN: 0.4440, AUPR_OUT: 0.8189
to spreadsheet: 0.6547919995146319,0.8916334661354581,0.5636946602646465,0.7263034243397944,0.6679269622855226,0.8795749704840614,0.6542374919495715,0.6556848855214703,0.6600847271392487,0.8867745004757374,0.44398894887400175,0.8188835175781194

Cosine similarities with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.1713197969543147, Clf Bal Acc: 0.25
SRC->TAR1:      AUROC: 0.6075, FPR95: 0.9187, AUPR_IN: 0.4918, AUPR_OUT: 0.6938
SRC->TAR2:      AUROC: 0.6485, FPR95: 0.9103, AUPR_IN: 0.6415, AUPR_OUT: 0.6268
SRC->TAR1+TAR2: AUROC: 0.6240, FPR95: 0.9153, AUPR_IN: 0.3909, AUPR_OUT: 0.7968
to spreadsheet: 0.6075328129107934,0.9187250996015937,0.4917670151482667,0.6938012292783111,0.6484996314253352,0.910271546635183,0.6415268839228061,0.6268239401847957,0.6240403748907253,0.9153187440532826,0.39093863325336187,0.7968484211037725
################################################################################

################################################################################
Computing OOD metrics with ODIN normality score...
  0% 0/788 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 788/788 [00:43<00:00, 18.00it/s]
100% 1255/1255 [01:08<00:00, 18.22it/s]
100% 847/847 [00:46<00:00, 18.21it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6249, FPR95: 0.8996, AUPR_IN: 0.4639, AUPR_OUT: 0.7202
SRC->TAR2:      AUROC: 0.6108, FPR95: 0.8973, AUPR_IN: 0.5823, AUPR_OUT: 0.6152
SRC->TAR1+TAR2: AUROC: 0.6192, FPR95: 0.8987, AUPR_IN: 0.3483, AUPR_OUT: 0.8053
to spreadsheet: 0.6249266891823569,0.899601593625498,0.46394329783974286,0.7202127292750814,0.6108286037912249,0.89728453364817,0.5822760648243527,0.6151538776064358,0.619245871710288,0.8986679352997146,0.3482596012648481,0.8052907155534039
################################################################################

################################################################################
Computing OOD metrics with Energy normality score...
  0% 0/788 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 788/788 [00:17<00:00, 45.15it/s]
100% 1255/1255 [00:28<00:00, 44.75it/s]
100% 847/847 [00:18<00:00, 44.98it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6260, FPR95: 0.8988, AUPR_IN: 0.4650, AUPR_OUT: 0.7200
SRC->TAR2:      AUROC: 0.6069, FPR95: 0.8973, AUPR_IN: 0.5798, AUPR_OUT: 0.6117
SRC->TAR1+TAR2: AUROC: 0.6183, FPR95: 0.8982, AUPR_IN: 0.3480, AUPR_OUT: 0.8043
to spreadsheet: 0.6259803425890348,0.8988047808764941,0.4649734136277122,0.7199600615917343,0.606921113035557,0.89728453364817,0.5798135540219752,0.6116589322188964,0.6183004342009302,0.8981921979067554,0.34797823595274713,0.8042815255079037
################################################################################

################################################################################
Computing OOD metrics with GradNorm normality score...
  0% 0/788 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 788/788 [00:26<00:00, 29.20it/s]
100% 1255/1255 [00:42<00:00, 29.24it/s]
100% 847/847 [00:29<00:00, 28.97it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6212, FPR95: 0.9195, AUPR_IN: 0.4891, AUPR_OUT: 0.7121
SRC->TAR2:      AUROC: 0.5614, FPR95: 0.9244, AUPR_IN: 0.5390, AUPR_OUT: 0.5743
SRC->TAR1+TAR2: AUROC: 0.5971, FPR95: 0.9215, AUPR_IN: 0.3482, AUPR_OUT: 0.7908
to spreadsheet: 0.6211842983396363,0.9195219123505977,0.4890795509560769,0.7120955797814004,0.5614425952450872,0.9244391971664699,0.5389567274988206,0.5743174059010767,0.5971114046569137,0.9215033301617507,0.34819104127592915,0.7908447576789785
################################################################################

################################################################################
Building React validation loader...
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR2_test.h5
ModelNet40_OOD - split: test, categories: {'bed': 0, 'toilet': 1, 'desk': 2, 'monitor': 3, 'table': 2}
React Val - SR2 data len: 486
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 486/486 [00:05<00:00, 89.26it/s] 
t = 2.6836
Computing OOD metrics with React (+Energy) normality score, ID-dependent threshold (=2.6836)...
React - using SR2 test to compute threshold
100% 788/788 [00:17<00:00, 44.49it/s]
100% 1255/1255 [00:28<00:00, 44.42it/s]
100% 847/847 [00:19<00:00, 44.45it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6272, FPR95: 0.8972, AUPR_IN: 0.4680, AUPR_OUT: 0.7203
SRC->TAR2:      AUROC: 0.6088, FPR95: 0.8949, AUPR_IN: 0.5831, AUPR_OUT: 0.6136
SRC->TAR1+TAR2: AUROC: 0.6198, FPR95: 0.8963, AUPR_IN: 0.3509, AUPR_OUT: 0.8050
to spreadsheet: 0.6272453333872632,0.8972111553784861,0.46795187429033447,0.720336621607351,0.6087939517796463,0.8949232585596222,0.5831078827325094,0.6135711011309382,0.6198103570686849,0.8962892483349191,0.35093382447401017,0.8049540127640686
################################################################################