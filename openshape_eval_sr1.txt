Cannot import torchlars
Cannot load RSCNN: No module named 'pointnet2_ops'
Cannot load PCT: No module named 'pointnet2_ops'
Cannot load PointMLP: No module named 'pointnet2_ops'
Cannot load PointNet2: No module named 'pointnet2_ops'
out-of-distribution eval - Modelnet -> SONN ..
Arguments: Namespace(local_rank=None, use_sync_bn=False, use_amp=False, script_mode='eval', config='cfgs/openshape.yaml', seed=1, epochs=250, batch_size=1, num_workers=4, resume=None, apply_fix_cellphone=True, data_root='./3D_OS_release_data', checkpoints_dir='outputs', exp_name='os_sr1', eval_step=1, save_step=10, ckpt_path='/content/3D-semantic-novelty-detection/openshape-pointbert-vitg14-rgb/model.pt', src='SR1', sonn_split='main_split', sonn_h5_name='objectdataset.h5', augm_set='rw', grad_norm_clip=-1, num_points=1024, num_points_test=2048, wandb_name=None, wandb_group='md-2-sonn-augmCorr', wandb_proj='benchmark-3d-ood-cla', loss='CE', cs=False, cs_gan_lr=0.0002, cs_beta=0.1, save_feats=None, corruption=None, tar1='none', tar2='none')
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_train.h5
ModelNet40_OOD - split: train, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
SR1 train data len: 2378
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_test.h5
ModelNet40_OOD - split: test, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Src is SR1

ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {4: 0, 8: 1, 7: 2, 12: 3, 13: 4}, num samples: 1255
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {10: 0, 14: 1, 5: 2, 6: 3, 9: 2}, num samples: 788
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {0: 404, 1: 404, 2: 404, 3: 404, 11: 404}, num samples: 847
<All keys matched successfully>
Clf - feature encoder: openshape
Clf Head - num classes: 5, input dim: 1280, act: leakyrelu, dropout: 0.5
Model params count: 33.1153 M
Load weights:  <All keys matched successfully>
Classifier(
  (enco): Projected(
    (ppat): PointPatchTransformer(
      (sa): PointNetSetAbstraction(
        (mlp_convs): ModuleList(
          (0): Conv2d(9, 64, kernel_size=(1, 1), stride=(1, 1))
          (1): Conv2d(64, 64, kernel_size=(1, 1), stride=(1, 1))
          (2): Conv2d(64, 256, kernel_size=(1, 1), stride=(1, 1))
        )
        (mlp_bns): ModuleList(
          (0-1): 2 x BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (2): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
        )
      )
      (lift): Sequential(
        (0): Conv1d(259, 512, kernel_size=(1,), stride=(1,))
        (1): Lambda()
        (2): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
      )
      (transformer): Transformer(
        (layers): ModuleList(
          (0-11): 12 x ModuleList(
            (0): PreNorm(
              (norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
              (fn): Attention(
                (attend): Softmax(dim=-1)
                (dropout): Dropout(p=0.0, inplace=False)
                (to_qkv): Linear(in_features=512, out_features=1536, bias=False)
                (to_out): Sequential(
                  (0): Linear(in_features=512, out_features=512, bias=True)
                  (1): Dropout(p=0.0, inplace=False)
                )
              )
            )
            (1): PreNorm(
              (norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
              (fn): FeedForward(
                (net): Sequential(
                  (0): Linear(in_features=512, out_features=1536, bias=True)
                  (1): GELU(approximate='none')
                  (2): Dropout(p=0.0, inplace=False)
                  (3): Linear(in_features=1536, out_features=512, bias=True)
                  (4): Dropout(p=0.0, inplace=False)
                )
              )
            )
          )
        )
      )
    )
    (proj): Linear(in_features=512, out_features=1280, bias=True)
  )
  (penultimate): Sequential(
    (0): Linear(in_features=1280, out_features=512, bias=False)
    (1): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): LeakyReLU(negative_slope=0.2)
    (3): Dropout(p=0.5, inplace=False)
    (4): Linear(in_features=512, out_features=256, bias=False)
  )
  (head): Sequential(
    (0): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (1): LeakyReLU(negative_slope=0.2)
    (2): Dropout(p=0.5, inplace=False)
    (3): Linear(in_features=256, out_features=5, bias=True)
  )
)
100% 1255/1255 [00:31<00:00, 39.50it/s]
100% 788/788 [00:18<00:00, 42.31it/s]
100% 847/847 [00:20<00:00, 41.38it/s]

################################################################################
Computing OOD metrics with MSP normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.3346613545816733, Clf Bal Acc: 0.26080671386198157
SRC->TAR1:      AUROC: 0.5386, FPR95: 0.9505, AUPR_IN: 0.6666, AUPR_OUT: 0.4034
SRC->TAR2:      AUROC: 0.5185, FPR95: 0.9457, AUPR_IN: 0.6127, AUPR_OUT: 0.4161
SRC->TAR1+TAR2: AUROC: 0.5282, FPR95: 0.9480, AUPR_IN: 0.4685, AUPR_OUT: 0.5809
to spreadsheet: 0.5385938479584201,0.950507614213198,0.6665737829444319,0.40338576907535884,0.5184983795632111,0.9456906729634003,0.6126549211458877,0.4161172617428366,0.5281835349732569,0.9480122324159022,0.468484739518235,0.5809447339474765
################################################################################

################################################################################
Computing OOD metrics with MLS normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.3346613545816733, Clf Bal Acc: 0.26080671386198157
SRC->TAR1:      AUROC: 0.5309, FPR95: 0.9581, AUPR_IN: 0.6615, AUPR_OUT: 0.3936
SRC->TAR2:      AUROC: 0.4712, FPR95: 0.9740, AUPR_IN: 0.5922, AUPR_OUT: 0.3684
SRC->TAR1+TAR2: AUROC: 0.5000, FPR95: 0.9664, AUPR_IN: 0.4550, AUPR_OUT: 0.5498
to spreadsheet: 0.5308795275749792,0.9581218274111675,0.6614887681352257,0.3936375319302979,0.4711806845816262,0.974025974025974,0.5922011704296721,0.36840654443604004,0.49995297099065505,0.9663608562691132,0.4549522047377813,0.5497588024765618
################################################################################

################################################################################
Computing OOD metrics with entropy normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.3346613545816733, Clf Bal Acc: 0.26080671386198157
SRC->TAR1:      AUROC: 0.5375, FPR95: 0.9505, AUPR_IN: 0.6668, AUPR_OUT: 0.3993
SRC->TAR2:      AUROC: 0.5223, FPR95: 0.9351, AUPR_IN: 0.6146, AUPR_OUT: 0.4209
SRC->TAR1+TAR2: AUROC: 0.5296, FPR95: 0.9425, AUPR_IN: 0.4696, AUPR_OUT: 0.5812
to spreadsheet: 0.5374896353671608,0.950507614213198,0.6668160830380871,0.39925026224246696,0.5222580751374666,0.935064935064935,0.6146396322455889,0.42088796403767204,0.5295990350524507,0.9425076452599388,0.4696173205600703,0.5812476873730759
################################################################################

################################################################################
Computing OOD metrics with distance from train features...
  0% 0/2378 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 2378/2378 [00:56<00:00, 41.99it/s]
100% 1255/1255 [00:30<00:00, 40.57it/s]
100% 788/788 [00:19<00:00, 40.61it/s]
100% 847/847 [00:20<00:00, 41.20it/s]
Euclidean distances in a non-normalized space:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.4701195219123506, Clf Bal Acc: 0.4485625097664984
SRC->TAR1:      AUROC: 0.5307, FPR95: 0.9454, AUPR_IN: 0.6609, AUPR_OUT: 0.3974
SRC->TAR2:      AUROC: 0.5847, FPR95: 0.9551, AUPR_IN: 0.7025, AUPR_OUT: 0.4401
SRC->TAR1+TAR2: AUROC: 0.5587, FPR95: 0.9505, AUPR_IN: 0.5227, AUPR_OUT: 0.5902
to spreadsheet: 0.5307495904706048,0.9454314720812182,0.6608810530755689,0.39737056763295237,0.5847288531823122,0.9551357733175915,0.7024752516319219,0.44006534304292616,0.5587131595940398,0.9504587155963303,0.5226938810588095,0.5902351373774941

Euclidean distances with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.21274900398406374, Clf Bal Acc: 0.2
SRC->TAR1:      AUROC: 0.5012, FPR95: 0.9581, AUPR_IN: 0.6283, AUPR_OUT: 0.3792
SRC->TAR2:      AUROC: 0.5510, FPR95: 0.9516, AUPR_IN: 0.6540, AUPR_OUT: 0.4254
SRC->TAR1+TAR2: AUROC: 0.5270, FPR95: 0.9547, AUPR_IN: 0.4724, AUPR_OUT: 0.5740
to spreadsheet: 0.5011618500616821,0.9581218274111675,0.6282970822544242,0.3791964098127013,0.5509522711985588,0.9515938606847698,0.6540206836234063,0.42543950540394426,0.5269554199105718,0.9547400611620795,0.47239590425913736,0.5740084792992209

Cosine similarities on the hypersphere:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.48366533864541833, Clf Bal Acc: 0.462007042344324
SRC->TAR1:      AUROC: 0.5564, FPR95: 0.9277, AUPR_IN: 0.6669, AUPR_OUT: 0.4334
SRC->TAR2:      AUROC: 0.5771, FPR95: 0.9020, AUPR_IN: 0.6713, AUPR_OUT: 0.4848
SRC->TAR1+TAR2: AUROC: 0.5671, FPR95: 0.9144, AUPR_IN: 0.5065, AUPR_OUT: 0.6279
to spreadsheet: 0.5563830970534107,0.9276649746192893,0.6668515180307073,0.43338790968968366,0.5770683499767165,0.9020070838252656,0.6712936497867896,0.4848010889579926,0.5670989436748419,0.9143730886850153,0.5065167816165352,0.6278802606659405

Cosine similarities with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.21274900398406374, Clf Bal Acc: 0.2
SRC->TAR1:      AUROC: 0.5302, FPR95: 0.9594, AUPR_IN: 0.6538, AUPR_OUT: 0.3965
SRC->TAR2:      AUROC: 0.5415, FPR95: 0.8855, AUPR_IN: 0.6309, AUPR_OUT: 0.4691
SRC->TAR1+TAR2: AUROC: 0.5361, FPR95: 0.9211, AUPR_IN: 0.4746, AUPR_OUT: 0.6039
to spreadsheet: 0.5302187190324995,0.9593908629441624,0.653838365620544,0.3965328314540538,0.5415085819649383,0.885478158205431,0.630869010268233,0.4690654427551425,0.5360673513895489,0.9211009174311927,0.47460818625192347,0.603852222355933
################################################################################

################################################################################
Computing OOD metrics with ODIN normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [01:40<00:00, 12.53it/s]
100% 788/788 [01:02<00:00, 12.57it/s]
100% 847/847 [01:06<00:00, 12.65it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.5404, FPR95: 0.9492, AUPR_IN: 0.6676, AUPR_OUT: 0.4073
SRC->TAR2:      AUROC: 0.5277, FPR95: 0.9421, AUPR_IN: 0.6189, AUPR_OUT: 0.4263
SRC->TAR1+TAR2: AUROC: 0.5338, FPR95: 0.9456, AUPR_IN: 0.4724, AUPR_OUT: 0.5880
to spreadsheet: 0.5404417861548729,0.949238578680203,0.6676072117294365,0.40734206494733993,0.5276843041058905,0.9421487603305785,0.6189358684529008,0.42625391325438133,0.533832864261608,0.945565749235474,0.4724270174051287,0.5879834186167542
################################################################################

################################################################################
Computing OOD metrics with Energy normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [00:32<00:00, 38.85it/s]
100% 788/788 [00:20<00:00, 38.29it/s]
100% 847/847 [00:22<00:00, 38.31it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.5284, FPR95: 0.9492, AUPR_IN: 0.6542, AUPR_OUT: 0.3956
SRC->TAR2:      AUROC: 0.4602, FPR95: 0.9811, AUPR_IN: 0.5860, AUPR_OUT: 0.3612
SRC->TAR1+TAR2: AUROC: 0.4931, FPR95: 0.9657, AUPR_IN: 0.4478, AUPR_OUT: 0.5466
to spreadsheet: 0.5284314518575444,0.949238578680203,0.6542317084798217,0.3955685272534163,0.46020216654044976,0.9811097992916175,0.5860463701325831,0.3612268028974918,0.49308576093180795,0.9657492354740062,0.44777356000036805,0.5466437878398831
################################################################################

################################################################################
Computing OOD metrics with GradNorm normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [01:06<00:00, 18.98it/s]
100% 788/788 [00:41<00:00, 18.82it/s]
100% 847/847 [00:44<00:00, 18.92it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.5427, FPR95: 0.9645, AUPR_IN: 0.6694, AUPR_OUT: 0.4012
SRC->TAR2:      AUROC: 0.5209, FPR95: 0.9504, AUPR_IN: 0.6245, AUPR_OUT: 0.4107
SRC->TAR1+TAR2: AUROC: 0.5314, FPR95: 0.9572, AUPR_IN: 0.4788, AUPR_OUT: 0.5771
to spreadsheet: 0.542722510971343,0.9644670050761421,0.6693919046549608,0.4012256558874696,0.5208954030395537,0.9504132231404959,0.6245321969616198,0.41068579629174884,0.5314151345687587,0.9571865443425076,0.4788257954620625,0.5771013429555202
################################################################################

################################################################################
Building React validation loader...
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_test.h5
ModelNet40_OOD - split: test, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
React Val - SR1 data len: 340
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 340/340 [00:08<00:00, 38.04it/s]
t = 6.9810
Computing OOD metrics with React (+Energy) normality score, ID-dependent threshold (=6.9810)...
React - using SR1 test to compute threshold
100% 1255/1255 [00:33<00:00, 37.06it/s]
100% 788/788 [00:21<00:00, 36.77it/s]
100% 847/847 [00:23<00:00, 36.53it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.5003, FPR95: 0.9645, AUPR_IN: 0.6289, AUPR_OUT: 0.3746
SRC->TAR2:      AUROC: 0.4450, FPR95: 0.9835, AUPR_IN: 0.5740, AUPR_OUT: 0.3526
SRC->TAR1+TAR2: AUROC: 0.4717, FPR95: 0.9743, AUPR_IN: 0.4292, AUPR_OUT: 0.5307
to spreadsheet: 0.5002912209031893,0.9644670050761421,0.6288695409526301,0.3746450344798873,0.4450185091981543,0.9834710743801653,0.5740214600577789,0.3525660467280316,0.4716575898241895,0.9743119266055046,0.42920700617082697,0.5307243390464872
################################################################################